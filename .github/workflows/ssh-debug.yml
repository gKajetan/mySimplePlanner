name: Simple SSH Test
on:
  workflow_dispatch: # Trigger manually from the "Actions" tab

jobs:
  verify_connection:
    runs-on: ubuntu-latest
    steps:
      - name: Write Log to VPS
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 22
          script_stop: true # Crucial: fails the job if any command errors out
          command_timeout: 2m
          script: |
            # 1. Define the file path (using the logged-in user's home directory)
            LOG_FILE="$HZ_HOME/github_connection_test.txt"

            # If $HZ_HOME is not set, fallback to user's home
            if [ -z "$LOG_FILE" ]; then
                LOG_FILE="/home/$(whoami)/github_connection_test.txt"
            fi

            # 2. Write details to the file
            echo "========================================" > "$LOG_FILE"
            echo "âœ… GitHub Actions Connection Successful" >> "$LOG_FILE"
            echo "Timestamp: $(date)" >> "$LOG_FILE"
            echo "User: $(whoami)" >> "$LOG_FILE"
            echo "Hostname: $(hostname)" >> "$LOG_FILE"
            echo "========================================" >> "$LOG_FILE"

            # 3. Output success to the GitHub Actions Console
            echo "Log file created at: $LOG_FILE"
